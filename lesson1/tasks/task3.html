<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="../../tasks.css">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Tradução</title>
</head>
<body>

<h2>Traduzir esta frase</h2>

<div id="questions-container">
<!-- As perguntas serão adicionadas por script -->
</div>

<button onclick="check()">Verificar</button>
<p id="result"></p>

<script>
const questions = [
{
id: "t1",
text: "丙寅卜",
Pinyin: "bǐng yín bo",
opções: [
"adivinhação no Dia de Bingyin",
"o governante leu a sorte",
"no Dia de Bingmao",
"sacrifício no templo"
],
correto: "adivinhação no Dia de Bingyin"
},
{
id: "t2",
texto: "王占曰",
Pinyin: "wáng zhàn yuē",
opções: [
"o governante disse",
"o governante interpretou",
"o rei ordenou",
"ele escreveu"
],
correto: "o governante interpretou"
}
];

function shuffleArray(array) {
const arr = [...array];
for (seja i = arr.length - 1; i > 0; i--) {
const j = Math.floor(Math.random() * (i + 1));
[arr[i], arr[j]] = [arr[j], arr[i]];
}
return arr;
}

function loadQuestions() {
const container = document.getElementById("questions-container");
container.innerHTML = "";

const shuffled = shuffleArray(questions);

shuffled.forEach(q => {
const questionDiv = document.createElement("div");
questionDiv.className = "question";
questionDiv.innerHTML = `
<p><strong>${q.text}</strong></p>
<div class="pinyin-container">
<button class="pinyin-toggle" onclick="this.nextElementSibling.classList.toggle('expanded'); this.classList.toggle('expanded')">
Mostrar pinyin
</button>
<div class="pinyin-text">${q.pinyin}</div>
</div>
<div class="options">
${q.options.map(option => `
<label>
<input type="radio" name="${q.id}" value="${option}">
${option}
</label>
`).join("")}
</div>
`;
container.appendChild(questionDiv);
});
}

function check() {
const selectedT1 = document.querySelector('input[name="t1"]:checked');
const selectedT2 = document.querySelector('input[name="t2"]:checked');
const resultEl = document.getElementById("result");

if (!selectedT1 || !selectedT2) {
resultEl.textContent = "Selecione ambas as opções.";
sendResult(false, "Nem todos os campos estão preenchidos");
return;
}

const correctT1 = questions.find(q => q.id === "t1").correct;
const correctT2 = questions.find(q => q.id === "t2").correct;

const match1 = selectedT1.value === correctT1;
const match2 = selectedT2.value === correctT2;

if (match1 && match2) {
resultEl.textContent = "✅ Correto!";
sendResult(true);
} else {
resultEl.textContent = "❌ Erro. ​​Erro — discurso direto, erro — para interpretar.";
sendResult(false, "Escolha incorreta");
}
}

function sendResult(success, message) {
window.parent.postMessage({ type: "TASK_RESULT", success, message }, "*");
}

window.onload = loadQuestions;

// Sinaliza a existência de uma tarefa
window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
</script>
</corpo>
</html>