<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="../../tasks.css">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Correspondência: Kanji ↔ Pronúncia</title>
</head>
<body>
<h2>Combine o Kanji e sua transcrição</h2>
<p>Clique no Kanji à esquerda e, em seguida, na pronúncia à direita</p>

<div class="match-container">
<div class="column">
<h3>Palavras-chave</h3>
<div id="words"></div>
</div>
<div class="column">
<h3>Pronúncia</h3>
<div id="defs"></div>
</div>
</div>

<button onclick="reset()">Redefinir</button>
<p id="result"></p>

<script>
const pairs = [
{ char: "占", significando: "zhān" },
{ char: "亥", significando: "hài" },
{ char: "壬", significando: "rén" },
{ char: "雨", significando: "yǔ" },
{ char: "寅", significando: "yín" }
];

let selectedWord = null;
let matchedPairs = 0;

function shuffle(arr) {
return [...arr].sort(() => Math.random() - 0.5);
}

function init() {
const wordList = document.getElementById("palavras");
const defList = document.getElementById("defs");

wordList.innerHTML = "";

defList.innerHTML = "";

const shuffledChars = shuffle(pares);
const shuffledMeanings = shuffle(pares.map(p => p.meaning));

shuffledChars.forEach(item => {
const el = document.createElement("div");
el.className = "palavra-item";
el.dataset.char = item.char;
el.textContent = item.char;
el.onclick = () => selectWord(el);
wordList.appendChild(el);
});

shuffledMeanings.forEach(meaning => {
const el = document.createElement("div");
el.className = "def-item";
el.dataset.meaning = meaning;
el.textContent = meaning;
el.onclick = () => selectDefinition(el);
defList.appendChild(el);
});
}

function selectWord(el) {
if (el.classList.contains("matched")) return;
document.querySelectorAll(".word-item.selected").forEach(e => e.classList.remove("selected"));
selectedWord = null;
el.classList.add("selected");
selectedWord = el;
}

function selectDefinition(el) {
if (el.classList.contains("correspondente") || !selectedWord) return;

const char = selectedWord.dataset.char;
const meaning = el.dataset.meaning;
const isCorrect = pairs.some(p => p.char === char && p.meaning === meaning);

if (isCorrect) {
el.classList.add("correspondente");
electedWord.classList.add("correspondente");
electedWord.onclick = null;
el.onclick = null;
electedWord = null;
matchedPairs++;

if (matchedPairs === 5) {
document.getElementById("result").textContent = "✅ Isso mesmo!";
document.getElementById("resultado").style.color = "#27ae60";
sendResult(true);
}
} else {
document.getElementById("resultado").textContent = "❌ Incorreto.";
document.getElementById("resultado").style.color = "#e74c3c";
setTimeout(() => {
document.getElementById("resultado").textContent = "";
}, 1500);

selectedWord.classList.remove("selected");
selectedWord = null;
}
}

function reset() {
matchedPairs = 0;
document.getElementById("resultado").textContent = "";
init();
}

function sendResult(sucesso, mensagem = "") {
window.parent.postMessage({
type: "TASK_RESULT",
success,
message: message || "Todos os pares estão corretos"
}, "*");
}

init();
window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
</script>
</body>
</html>