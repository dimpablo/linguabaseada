<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="../../tasks.css">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Corresponder</title>
</head>
<body>

<h2>Corresponder o caractere e seu significado</h2>
<p class="intro">Clique no caractere e, em seguida, no significado</p>

<div class="column">
<h3>Hieróglifos</h3>
<div id="words"></div>
</div>

<div class="column">
<h3>Significados</h3>
<div id="defs"></div>
</div>

<button onclick="reset()">Redefinir</button>
<p id="result"></p>

<script>
const pairs = [
{ char: "壬", que significa: "Raiz celestial (9º);" },
{ char: "其", que significa: "Advérbio: "será?"" },
{ char: "己", que significa: "Raiz celestial (6º);" },
{ char: "卜", que significa: "Adivinhação" },
{ char: "允", que significa: "De fato; confirmação" }
];

let selectedWord = null;
let matchedPairs = 0;

function shuffle(arr) {
return [...arr].sort(() => Math.random() - 0.5);
}

function init() {
const wordList = document.getElementById("palavras");
const defList = document.getElementById("defs");

wordList.innerHTML = "";
defList.innerHTML = "";

const shuffledChars = shuffle(pairs);
const shuffledMeanings = shuffle(pairs.map(p => p.meaning));

// Cria hieróglifos
shuffledChars.forEach(item => {
const el = document.createElement("div");
el.className = "word-item";
el.dataset.char = item.char;
el.textContent = item.char;
el.onclick = () => selectWord(el);
wordList.appendChild(el);
});

// Cria valores
shuffledMeanings.forEach(meaning => {
const el = document.createElement("div");
el.className = "def-item";
el.dataset.meaning = meaning;
el.textContent = meaning;
el.onclick = () => selectDefinition(el);
defList.appendChild(el);
});
}

function selectWord(el) {
if (el.classList.contains("matched")) return;
document.querySelectorAll(".word-item.selected").forEach(e => e.classList.remove("selected"));
selectedWord = null;
el.classList.add("selected");
selectedWord = el;
}

function selectDefinition(el) {
if (el.classList.contains("correspondente") || !selectedWord) return;

const char = selectedWord.dataset.char;
const meaning = el.dataset.meaning;
const isCorrect = pairs.some(p => p.char === char && p.meaning === meaning);

if (isCorrect) {
el.classList.add("correspondente");
selectedWord.classList.add("correspondente");
selectedWord.onclick = null;
el.onclick = null;
selectedWord = null;
matchedPairs++;

if (matchedPairs === 5) {
const resultEl = document.getElementById("result");
resultEl.textContent = "✅ Isso mesmo!";
resultEl.className = "sucesso";
sendResult(true);
}
} else {
document. getElementById("result"). textContent = "❌ Erro.";
setTimeout(() => {
document. getElementById("result"). textContent = "";
}, 1500);
selectedWord. classList. remove("selected");
selectedWord = null;
}
}

function reset() {
matchedPairs = 0;
document. getElementById("result"). textContent = "";
document. getElementById("result"). className = "";
init();
}

function sendResult(sucesso, mensagem) {
window.parent.postMessage({
type: "TASK_RESULT",
sucesso: !!sucesso,
mensagem: mensagem || (sucesso ? "Todos os pares estão corretos" : "Erro")
}, "*");
}

window.onload = init;

window.parent.postMessage({type: "TASK_EXISTS", válido: verdadeiro }, "*");
</script>
</body>
</html>